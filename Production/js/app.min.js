!function(){var e=angular.module("EncoreMovies",[]);e.controller("microMoviesController",["$scope","$http","$rootScope","$location","$timeout",function(e,i,t,r,o){var n=$("body");i.get("data/movies.json").then(function(i){e.movies=i.data}),n.addClass("movies-long-list");var a=$("html");t.referrer="",t.isTouch=Modernizr.touch,t.isOldIE=a.hasClass("lt-ie10"),t.isFirefox=a.hasClass("firefox"),t.showModalMobileClose=!1,document.referrer&&!function(){var e=document.referrer.split("/")[2];e===r.host()&&(t.referrer=document.referrer)}(),t.isPortrait="portrait"===Detectizr.device.orientation||"desktop"===Detectizr.device.type&&window.innerHeight>=window.innerWidth,t.isLandscape="landscape"===Detectizr.device.orientation||"desktop"!==Detectizr.device.type||window.innerHeight<window.innerWidth,t.deviceType=Detectizr.device.type,t.isMobile="mobile"===Detectizr.device.type||"kindle"===Detectizr.device.model,t.isTablet="tablet"===Detectizr.device.type&&"kindle"!==Detectizr.device.model,t.isDesktop="desktop"===Detectizr.device.type,jQuery(window).on("resize orientationchange",function(){setTimeout(function(){t.$apply(function(){t.isPortrait="portrait"===Detectizr.device.orientation||"desktop"===Detectizr.device.type&&window.innerHeight>=window.innerWidth,t.isLandscape="landscape"===Detectizr.device.orientation&&("desktop"!==Detectizr.device.type||window.innerHeight<window.innerWidth)})},10)}),t.$on("$locationChangeStart",function(e,i,r){i=i.replace(/\/((#|\?).*)?$/,""),r=r.replace(/\/((#|\?).*)?$/,""),i!==r&&(t.referrer=r,t.thisRouteHasCarousel||r.match(/video/)||r.match(/search/)||(t.carouselImage=!1),t.thisRouteHasCarousel=!1)}),t.getCascadedBackgroundImage=function(){var e="/Content/img/bg/bokeh.jpg";return t.carouselImage?e=t.carouselImage:(t.referrer.match(/originals\/[^/]+/)||t.referrer.match(/video/))&&t.originalImage&&(e=t.originalImage),e},t.isImageSizeSmall=function(){return t.isMobile?t.isPortrait?jQuery(window).width()<=768:jQuery(window).width()<=1280:jQuery(window).width()<=1024},t.isImageSizeMedium=function(){return t.isMobile?jQuery(window).width()>768:jQuery(window).width()>1024&&jQuery(window).width()<=1920},t.isImageSizeLarge=function(){return t.isMobile?t.isPortrait?jQuery(window).width()>768:jQuery(window).width()>1800:jQuery(window).width()>1920},t.imageSizeType=function(){return t.isMobile?t.isImageSizeSmall()?"small":t.isImageSizeLarge()?"large":"small":t.isImageSizeSmall()?"small":t.isImageSizeMedium()?"medium":t.isImageSizeLarge()?"large":"medium"},t.trustedHtml=function(e){return $sce.trustAsHtml(e)},t.forceSSL=function(){"https"!==r.protocol()&&($window.location.href=r.absUrl().replace("http","https"))},t.isActiveMenuLocation=function(e){var i=e.toString();return i.length>0&&0===r.path().indexOf(i)},t.playFeaturedVid=function(e,i,o){r.url(t.getVideoUrl(e,i,o,!0))},t.getVideoUrl=function(e,i,t,r){var o="/video/";if(e)return i?o="/originals/"+i+o+e:o+="movie"===t?"movie/"+e:"preview"===t?"preview/"+e:e,r||(o="http://www.starz.com/"+o),o},t.closeModal=function(){var e="/";t.referrer?window.history.back():0===r.path().indexOf("/video/movie")?!function(){var e;e=r.path.match(/\/video\/movie\/([\d]+)/),e=e[1],r.path("/movies/detail/"+e)}():0===r.path().indexOf("/originals")?!function(){var e;e=r.path.match(/^\/originals\/[^/]/),e=e[0],r.url(e)}():r.url(e)}}]),e.directive("encoreMoviesSlider",["$location","$rootScope","$timeout",function(e,i,t){var r={restrict:"A",templateUrl:"templates/slider.html",link:function(r,o,n){function a(){t(function(){o.show();var e=o.find(".movie-thumb");o.css("max-width",e.filter(":first").outerWidth()*e.length),o.slick({slide:".movie-thumb",slidesToShow:9,slidesToScroll:8,lazyLoad:"ondemand",infinite:!1,responsive:[{breakpoint:2149,settings:{slidesToShow:8,slidesToScroll:7}},{breakpoint:1919,settings:{slidesToShow:7,slidesToScroll:6}},{breakpoint:1799,settings:{slidesToShow:6,slidesToScroll:5}},{breakpoint:1544,settings:{slidesToShow:5,slidesToScroll:4}},{breakpoint:1289,settings:{slidesToShow:4,slidesToScroll:3}},{breakpoint:1034,settings:{slidesToShow:3,slidesToScroll:2}},{breakpoint:779,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:640,settings:{slidesToShow:4,slidesToScroll:3}},{breakpoint:567,settings:{slidesToShow:3,slidesToScroll:2}},{breakpoint:473,settings:{slidesToShow:2,slidesToScroll:1}}]})},50)}function s(e){return e===r.currentMovie}function d(n,a){function s(t){n.details||(n.details=t),r.isLoadingDetails=!1,r.expanderDetails=t,r.videoShareTitle=n.details.title,r.videoShareUrl=i.getVideoUrl(n.id,"","movie"),r._previewAddPlayer(),l("Expanded View",n.details),r.addLocationHash&&e.replace().hash(o.prop("id"))}r.previewIsActive=!1,r.previewIsPlaying=!1,r.previewIsLoading=!1,r.previewIsWatched=!1,n.details?r.expanderDetails&&n.details.Title===r.expanderDetails.Title&&n.details.Description===r.expanderDetails.Description&&a===r.currentMovie?p():(r.currentMovie=a,r.activeRowIndex=a,s(n.details)):(r.isLoadingDetails=!0,r.currentMovie=a,r.expanderDetails={},getmovieDetail(n.id)),r.activeRowIndex=r.rowIndex,t(function(){r.$apply()})}function l(e,i){$.extend(i,{Category:r.movieListTitle})}function p(){r.currentMovie=-1,r.previewIsPlaying=!1,r.previewIsWatched=!1}function c(e){return moment.tz(e.start,M).format("h:mm")+" - "+moment.tz(e.end,M).format("h:mm a")+" EST"}function w(){var e=!0;return r.isMobile||r.isTablet?e=!1:r.expanderDetails&&r.expanderDetails.HasPreview&&("movie"!==r.expanderDetails.Type.toLowerCase()||r.expanderDetails.InstantPreviewSmall)?r.expanderDetails.InstantPreviewSmall||r.expanderDetails.PreviewDesktop||(e=!1):e=!1,e}function u(e){var i,t,o="";return e?(i=moment.tz(r.currentDate,M),t=moment(e.AirDateTime),o+=r.todayMoment.year()===t.year()&&r.todayMoment.month()===t.month()&&r.todayMoment.date()===t.date()?"Today":t.format("M.D"),o+=t.format(" @ h:mma")+" EST"):""}function v(){var e=jwplayer("expander-preview-row-"+r.rowIndex);r.previewIsMuted=!r.previewIsMuted,e.setMute(r.previewIsMuted)}function m(){return!!r.expanderDetails.instantPreviewUrl}function g(){var e="";return"movie"===r.expanderDetails.type&&(r.expanderDetails.instantPreviewUrl?e="/video/preview/"+r.expanderDetails.id:r.expanderDetails.PreviewDesktop&&(e="/video/movie/"+r.expanderDetails.id)),e}function h(){r.expanderDetails&&r.expanderDetails.HasPreview&&w()&&t(function(){var e=jwplayer("expander-preview-row-"+r.rowIndex),i=$(".loading-content");i.starzLoader("show"),r.previewIsActive=!0,r.previewIsMuted=!0,e.setup({autostart:!0,repeat:!1,controls:!1,flashplayer:"http://www.starz.com/Scripts/Vendor/jwplayer/player.swf",width:"100%",aspectratio:"16:9",assetName:"Feature Video",stretching:"fill",mute:r.previewIsMuted,androidhls:!0,primary:"html5",playlist:[{image:r.expanderDetails.PosterUrl,sources:[{file:r.expanderDetails.InstantPreviewSmall?r.expanderDetails.InstantPreviewSmall:r.expanderDetails.PreviewDesktop}]}]}).onBuffer(function(e){t(function(){r.previewIsLoading=!0,r.$apply()},1)}).onIdle(function(e){t(function(){r.previewIsLoading=!1,r.previewIsPlaying=!1},1)}).onReady(function(){t(function(){r.previewStartVideo()},1)}).onPlay(function(){t(function(){r.previewIsLoading=!1,r.previewIsPlaying=!0,r.$apply()},1)}).onComplete(function(){t(function(){r.previewIsActive=!1,r.previewIsPlaying=!1,r.previewIsLoading=!1,r.previewIsWatched=!0,r.$apply()},1)})},10)}function f(){var e=jwplayer("expander-preview-row-"+r.rowIndex);if(r.showPreviewVideo()&&"PLAYING"!==e.getState()&&"BUFFERING"!==e.getState())return r.previewIsPlaying=!0,r.previewIsActive=!0,r.previewIsLoading=!0,"undefined"!=typeof e.getState()?void(("IDLE"===e.getState()||"PAUSED"===e.getState())&&e.play(!0)):void r._previewAddPlayer()}function y(){r.previewIsLoading=!1;var e=jwplayer("expander-preview-row-"+r.rowIndex);e.stop()}function S(){}function I(e,i){var t={};t.id=r.expanderDetails.mediaId,"movie"===r.expanderDetails.type.toLowerCase()?(t.origString="",t.subtype=i?"preview":"movie",r.playFeaturedVid(t.id,t.origString,t.subtype)):"original"===r.expanderDetails.type.toLowerCase()&&r.playFeaturedVid(t.id,r.expanderDetails.routeName)}function D(e){return"movie"===e.Type.toLowerCase()?"/movies/detail/"+e.routeName:"original"===e.Type.toLowerCase()?"/originals/"+e.routeName+"/featured":void 0}function x(e){return"movie"===e.type.toLowerCase()?window.location.protocol+"//"+window.location.hostname+"/movies/detail/"+e.routeName:"original"===e.type.toLowerCase()?window.location.protocol+"//"+window.location.hostname+"/originals/"+e.routeName+"/featured":void 0}function T(e,i){var t=e;return t&&t.length>i&&(t=t.substring(0,i).match(/^.*[\W]?[\s]/)[0].replace(/[\W]?[\s]*$/,"...")),t}var M="America/New_York";r.playFeaturedVid=i.playFeaturedVid,r.isMobile=i.isMobile,r.isTablet=i.isTablet,r.clickMovie=d,r.eventTrack=l,r.showTimes=c,r.closeExpander=p,r.isSelected=s,r.getDetailsAirTime=u,r.getTruncatedSummary=T,r.isInstantPreview=m,r.getPlayerExpanderLink=g,r.fullscreenVideo=I,r.getExpanderPath=D,r.getExpanderSharePath=x,r.expanderDetails=void 0,r.isLoadingDetails=!1,r.currentMovie=-1,r.previewIsActive=!1,r.previewIsLoading=!1,r.previewIsPlaying=!1,r.previewIsWatched=!1,r.previewIsMuted=!0,r.showPreviewVideo=w,r._previewAddPlayer=h,r.previewStartVideo=f,r.previewStopVideo=y,r.previewShareVideo=S,r.previewToggleMute=v,r.expanderDetails=void 0,r.todayMoment=moment.tz(new Date,M),r.currentDate=new Date(r.todayMoment.format()),n.$observe("index",function(e){r.rowIndex=e}),o.hide(),a()}};return r}])}();